# 数据接口

邮件检测系统提供了完整的邮件垃圾检测、历史记录管理、用户反馈和收藏功能的API接口。所有接口均采用RESTful设计规范，支持JSON格式的数据交互。

## 认证方式

* API Key (sessionAuth)
  * 参数名称: **sessionid**，位置: cookie

## 数据接口列表

### 检测历史 获取 方法

**GET** `/mail/history/`

#### 功能描述

获取用户的邮件检测历史记录，支持分页查询和条件筛选。

#### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| page | integer | 否 | 页码，默认为1 |
| page_size | integer | 否 | 每页记录数，默认为10 |
| result | string | 否 | 筛选检测结果：spam(垃圾邮件)、legitimate(正常邮件) |
| start_date | string(date) | 否 | 开始日期，格式：YYYY-MM-DD |
| end_date | string(date) | 否 | 结束日期，格式：YYYY-MM-DD |
| Cookie | string | 否 | 认证信息 |

#### 返回值格式

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "total": 17,
    "page": 1,
    "page_size": 10,
    "records": [
      {
        "id": 99,
        "email_subject": "会议通知：9月5日公司全体会议",
        "email_sender": "hr303115@gmail.com",
        "detection_result": "spam",
        "detection_result_display": "垃圾邮件",
        "confidence_score": 0.7,
        "created_at": "2025-08-28T14:45:23.042692"
      }
    ]
  }
}
```

#### 使用场景和注意事项

* 用于用户查看历史检测记录

* 支持按检测结果和时间范围筛选
* 返回数据包含分页信息，便于前端分页展示
* 需要用户登录认证

### 检测历史 详情 方法

**GET** `/mail/history/{record_id}/`

#### 功能描述

获取指定检测记录的详细信息，包括完整的邮件内容、风险因素和用户反馈。

#### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| record_id | integer | 是 | 检测记录ID |
| Cookie | string | 否 | 认证信息 |

#### 返回值格式

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "id": 99,
    "user": "pony",
    "email_subject": "会议通知：9月5日公司全体会议",
    "email_sender": "hr303115@gmail.com",
    "email_content": "邮件完整内容...",
    "input_type": "text",
    "input_type_display": "文本输入",
    "file_name": "",
    "detection_result": "spam",
    "detection_result_display": "垃圾邮件",
    "confidence_score": 0.7,
    "risk_factors": [],
    "user_feedback": "",
    "user_feedback_display": "",
    "created_at": "2025-08-28T14:45:23.042692",
    "updated_at": "2025-08-28T14:45:23.042692"
  }
}
```

#### 使用场景和注意事项

* 用于查看检测记录的完整详情

* 包含风险因素分析和用户反馈信息
* 需要用户登录认证且只能查看自己的记录

### 收藏列表 获取 方法

**GET** `/mail/favorites/`

#### 功能描述

获取用户收藏的检测记录列表，支持分页查询。

#### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| page | integer | 否 | 页码，默认为1 |
| page_size | integer | 否 | 每页记录数，默认为10 |
| Cookie | string | 否 | 认证信息 |

#### 返回值格式

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "total": 1,
    "page": 1,
    "page_size": 10,
    "favorites": [
      {
        "id": 1,
        "user": "pony",
        "detection_record": {
          "id": 18,
          "email_subject": "会议通知",
          "email_sender": "manager@company.com",
          "detection_result": "normal",
          "detection_result_display": "正常邮件",
          "confidence_score": 0.88,
          "created_at": "2025-08-28T10:51:34.886966"
        },
        "note": "收藏: 会议通知",
        "created_at": "2025-08-28T10:51:35.019373"
      }
    ]
  }
}
```

#### 使用场景和注意事项

* 用于管理用户收藏的重要检测记录

* 支持分页查询，便于大量收藏记录的管理
* 需要用户登录认证

### 用户仪表板 获取 方法

**GET** `/mail/dashboard/`

#### 功能描述

获取用户仪表板数据，包括检测统计信息和最近的检测记录。

#### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| Cookie | string | 否 | 认证信息 |

#### 返回值格式

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "total_checks": 17,
    "spam_blocked": 12,
    "favorite_emails": 0,
    "accuracy_rate": 0,
    "recent_detections": [
      {
        "id": 99,
        "email_subject": "会议通知：9月5日公司全体会议",
        "email_sender": "hr303115@gmail.com",
        "detection_result": "spam",
        "confidence_score": 0.7,
        "created_at": "2025-08-28T14:45:23.042692"
      }
    ]
  }
}
```

#### 使用场景和注意事项

* 用于用户首页仪表板数据展示

* 提供检测统计概览和最近检测记录
* 需要用户登录认证

### 用户统计 获取 方法

**GET** `/mail/statistics/`

#### 功能描述

获取用户详细的统计信息，包括基础统计、月度统计和风险因素统计。

#### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| period | string | 否 | 统计周期：month(月)、quarter(季度)、year(年) |
| start_date | string(date) | 否 | 开始日期，格式：YYYY-MM-DD |
| end_date | string(date) | 否 | 结束日期，格式：YYYY-MM-DD |
| Cookie | string | 否 | 认证信息 |

#### 返回值格式

```json
{
  "code": 200,
  "msg": null,
  "data": {
    "basic_stats": {
      "id": 4,
      "user": "pony",
      "total_detections": 17,
      "spam_detected": 12,
      "normal_detected": 5,
      "favorite_count": 0,
      "accuracy_rate": 0,
      "last_detection_time": "2025-08-28T14:45:23.044693",
      "created_at": "2025-08-28T11:15:14.616809",
      "updated_at": "2025-08-28T14:45:23.044693"
    },
    "monthly_stats": [
      {
        "month": "2025-08",
        "total": 17,
        "spam": 12,
        "normal": 5
      }
    ],
    "risk_factors_stats": {
      "邮件内容过短": 6,
      "发件人使用可疑域名: qq.com": 3,
      "包含可疑关键词: 大奖, 立即, 点击": 1
    }
  }
}
```

#### 使用场景和注意事项

* 用于统计分析页面的数据展示

* 支持不同时间周期的统计查询
* 提供风险因素分析，帮助用户了解检测模式
* 需要用户登录认证

## 通用方法

### 邮件检测

#### 文本检测 方法

**POST** `/mail/detect/`

##### 功能描述

检测邮件文本内容是否为垃圾邮件，支持邮件主题、发件人和内容的综合分析。

##### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| email_content | string | 是 | 邮件正文内容 |
| email_sender | string | 否 | 发件人邮箱地址 |
| email_subject | string | 否 | 邮件主题 |
| Cookie | string | 否 | 认证信息 |

##### 请求体示例

```json
{
  "email_content": "尊敬的您好！这是关于下周会议的通知，会议将于9月5日上午10点在公司大会议室举行，请您准时参加。",
  "email_sender": "hr303115@qq.com",
  "email_subject": "会议通知：9月5日公司全体会议"
}
```

##### 返回值格式

```json
{
  "success": true,
  "data": {
    "detection_result": "spam",
    "confidence_score": 0.7,
    "risk_factors": [
      "邮件内容过短",
      "发件人使用可疑域名"
    ],
    "record_id": 123
  }
}
```

##### 使用场景和注意事项

* 用于实时检测邮件内容

* detection_result 可能值：spam(垃圾邮件)、legitimate(正常邮件)
* confidence_score 为置信度分数，范围0-1
* risk_factors 包含检测到的风险因素列表
* 需要用户登录认证

#### 文件上传检测 方法

**POST** `/mail/detect/file/`

##### 功能描述

上传邮件文件进行垃圾邮件检测，支持多种邮件文件格式。

##### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| file | file | 是 | 邮件文件，支持.txt、.eml等格式 |
| sender_email | string | 否 | 发件人邮箱地址 |
| Cookie | string | 否 | 认证信息 |

##### 返回值格式

```json
{
  "success": true,
  "data": {
    "detection_result": "spam",
    "confidence_score": 0.8,
    "risk_factors": [
      "包含可疑关键词"
    ],
    "record_id": 124,
    "file_info": {
      "filename": "email.txt",
      "size": 1024
    }
  }
}
```

##### 使用场景和注意事项

* 用于批量检测或检测邮件文件

* 支持multipart/form-data格式上传
* 文件大小限制建议不超过10MB
* 返回结果包含文件信息
* 需要用户登录认证

### 用户反馈

#### 提交反馈 方法

**POST** `/feedback/`

##### 功能描述

用户对检测结果提供反馈，帮助改进检测算法的准确性。

##### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| record_id | integer | 是 | 检测记录ID |
| feedback_type | string | 是 | 反馈类型：correct(正确)、incorrect(错误) |
| actual_result | string | 否 | 实际结果：spam(垃圾邮件)、legitimate(正常邮件) |
| comments | string | 否 | 用户评论 |
| Cookie | string | 否 | 认证信息 |

##### 请求体示例

```json
{
  "record_id": 123,
  "feedback_type": "incorrect",
  "actual_result": "legitimate",
  "comments": "这是一封正常的工作邮件"
}
```

##### 返回值格式

```json
{
  "success": true,
  "data": {
    "message": "反馈提交成功，感谢您的反馈！"
  }
}
```

##### 使用场景和注意事项

* 用于收集用户对检测结果的反馈

* 帮助改进算法准确性
* 只能对自己的检测记录提供反馈
* 需要用户登录认证

### 收藏管理

#### 添加收藏 方法

**POST** `/mail/favorites/`

##### 功能描述

将检测记录添加到用户收藏列表，便于后续查看和管理。

##### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| record_id | integer | 是 | 检测记录ID |
| notes | string | 否 | 收藏备注 |
| Cookie | string | 否 | 认证信息 |

##### 请求体示例

```json
{
  "record_id": 123,
  "notes": "重要的会议通知邮件"
}
```

##### 返回值格式

```json
{
  "success": true,
  "data": {
    "message": "收藏成功"
  }
}
```

##### 使用场景和注意事项

* 用于收藏重要的检测记录

* 支持添加个人备注
* 只能收藏自己的检测记录
* 需要用户登录认证

#### 删除收藏 方法

**DELETE** `/mail/favorites/{favorite_id}/`

##### 功能描述

从用户收藏列表中删除指定的收藏记录。

##### 请求参数列表

| 参数名 | 类型 | 是否必填 | 说明 |
|--------|------|----------|------|
| favorite_id | integer | 是 | 收藏记录ID |
| Cookie | string | 否 | 认证信息 |

##### 返回值格式

```json
{
  "success": true,
  "message": "删除成功"
}
```

##### 使用场景和注意事项

* 用于删除不需要的收藏记录

* 只能删除自己的收藏记录
* 删除操作不可恢复
* 需要用户登录认证

## 错误码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 201 | 创建成功 |
| 204 | 删除成功 |
| 400 | 请求参数错误 |
| 401 | 认证失败 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 注意事项

1. 所有接口均需要通过sessionid进行身份认证
2. 请求和响应数据格式均为JSON
3. 文件上传接口使用multipart/form-data格式
4. 分页查询默认每页10条记录，最大不超过100条
5. 日期格式统一使用ISO 8601标准（YYYY-MM-DDTHH:mm:ss）
6. 所有时间均为UTC时间
7. API调用频率限制：每分钟最多100次请求
